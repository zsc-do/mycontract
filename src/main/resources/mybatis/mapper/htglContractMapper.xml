<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.it.mycontract.mapper.HtglContractMapper">


    <resultMap id="ContractResult" type="cn.it.mycontract.entity.HtglContract">
        <id column="id" property="id"/>
        <result column="code" property="code"/>
        <result column="name" property="name"/>
        <result column="sponsor_name" property="sponsorName"/>
        <result column="sponsor_id" property="sponsorId"/>
        <result column="operator_name" property="operatorName"/>
        <result column="operator_id" property="operatorId"/>
        <result column="draft_time" property="draftTime"/>
        <result column="budget_code" property="budgetCode"/>
        <result column="contrac_money" property="contractMoney"/>
        <result column="contractcnt" property="contractCnt"/>
        <result column="approve_time" property="approveTime"/>
        <result column="flow_status" property="flowStatus"/>


        <collection property="htglProcessRecordList" ofType="cn.it.mycontract.entity.HtglProcessRecord">
            <id column="record_id" property="id"/>
            <result column="record_status" property="status"></result>
        </collection>
    </resultMap>


    <!--
        查询用户部门的上级领导与所在部门
    -->
    <select id="selectLeader" resultType="cn.it.mycontract.entity.SysArea">

        SELECT
        sa1.id,
        sa1.`name`,
        su1.id as leader_id,
        su1.`name` as leader_name
    FROM
	sys_area sa1
	LEFT JOIN sys_user su1 ON sa1.leader_id = su1.id
WHERE
	sa1.id = ( SELECT sa.id
	FROM sys_user su
	LEFT JOIN sys_area sa
	ON su.area_id = sa.id
	WHERE su.account = #{account} )
    </select>

    <select id="selectHtqcRecode" resultMap="ContractResult">
        SELECT
        hc.*,
        hpr.id as record_id,
        hpr.`status` as record_status
    FROM
        htgl_contract hc
        LEFT JOIN htgl_process_record hpr ON hc.id = hpr.contract_id
    WHERE
        hpr.now_handler = #{id}
        AND hpr.`status` != 0
    </select>
</mapper>